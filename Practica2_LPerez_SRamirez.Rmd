---
title: 'Práctica 2: Limpieza y validación de los datos'
author: "Luis Manuel Pérez Geraldino y Sergi Ramirez Mitjans"
date: "16/5/2019"
output:
  html_document:
    df_print: paged
---



# 1. Detalles de la actividad
## 1.1 Descripción
## 1.2 Objetivos
## 1.3 Competencias
# 2. Resolución
## 2.1 Descripción del dataset

```{r}
# Creamos los path que posteriormente deberemos de cargar los objetos
path <- 'C:/Users/sergir/Desktop/result.csv'

# Leemos los datos para guardar
datos <- read.csv2(path, sep = ";", header = T, stringsAsFactors = T, dec = ".")

# Generamos el archivo metadata
library(Hmisc)
metadata <- contents(datos)
html(metadata)
```

## 2.2 Importancia y objetivos de los análisis
## 2.3 Limpieza de los datos
### 2.3.1 Transformación de los datos
```{r}
# Convertimos los valores de la fecha a character
datos[, 'Fecha.alta'] <- as.character(datos[, 'Fecha.alta'])
datos[, 'Fecha.baja'] <- as.character(datos[, 'Fecha.baja'])

# Separamos el código de la agrupación
codigos <- strsplit(as.character(datos[, 'Agrupación.homogénea']), "-")
data = data.frame(codigo = character(), agrupacion = character(), stringsAsFactors=FALSE)

for (i in 1:length(codigos)){
    if(codigos[i][1] == ""){
      data[i, 1] = as.character(codigos[[i]][1])
      data[i, 2] = as.character(codigos[[i]][1])
    } else {
      data[i, 1] = as.character(codigos[[i]][1])
      data[i, 2] = as.character(codigos[[i]][2])
    }
}

datos[, 'CodAgrupacion'] <- data[, 'codigo']

# Realizamos la separación por laboratorio
lab <- strsplit(as.character(datos[, 'Laboratorio']), ",")
data = data.frame(codigo = character(), laboratorio = character(), sociedad =  character(), stringsAsFactors=FALSE)

for (i in 1:length(codigos)){
    if(length(lab[[i]]) == 3){
      valor1 = as.character(lab[[i]][1])
      valor2 = as.character(lab[[i]][2])
      valor3 = as.character(lab[[i]][3])
    } else {
      if (length(lab[[i]]) == 2){
      valor1 = as.character(lab[[i]][1])
      valor2 = as.character(lab[[i]][2])
      valor3 = ""
      } else {
      valor1 = ""
      valor2 = as.character(lab[[i]][2])
      valor3 = ""
      }
    }
    data[i, 1] = valor1
    data[i, 2] = valor2
    data[i, 3] = valor3
}

datos[, 'CodLaboratorio'] <- data[, 'codigo']
```





### 2.3.1 Selección de los datos de interés

```{r}
# Separamos los valores numéricos de otros tipos de valores. Para ello vamos a primero mirar cuantos tipos de variables tenemos. 
lista_clase <- sapply(datos, class)
table(lista_clase)

t <- unname(which(lista_clase == 'factor'))

# Vemos que hemos de generar 4 tipos diferentes 


```


### 2.3.2 Ceros y elementos vacíos

Como tenemos en variables numéricas valores NA's deberemos de imputar estos registros para obtener los que realmente se consideren más cercanos. Para ello utilizaremos un método de imputación llamado *MICE*.

```{r}
# https://www.analyticsvidhya.com/blog/2016/03/tutorial-powerful-packages-imputing-missing-values/
library(mice)

md.pattern(datos)
imputed_Data <- mice(datos, m=5, maxit = 50, method = 'pmm', seed = 500)
completeData <- complete(imputed_Data)
```


### 2.3.3 Valores extremos
### 2.3.4 Exportación de los datos preprocesados
## 2.4 Análisis de los datos
### 2.4.1 Selección de los grupos de datos a analizar
### 2.4.2 Comprobación de la normalidad y homogeneidad de la varianza

```{r}

```


## 2.5 Pruebas estadísticas
### 2.5.1 ¿Existen diferencias en el precio según el tipo de medicamento? 

```{r}

```


### 2.5.2 ¿El precio del medicamento es influido por el laboratorio que lo genera?

```{r}

```

### 2.5.3 Modelo de predicción del precio
## 2.6 Conclusiones
# 3. Recursos

